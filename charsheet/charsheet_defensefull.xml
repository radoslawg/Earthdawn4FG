<?xml version="1.0" encoding="iso-8859-1"?>
<root version="2.0">
 	<windowclass name="defensefull">
		<frame>referencebox</frame>
		<placement>
			<size>
				<height>360</height>
				<width>250</width>
			</size>
		</placement>
		<minimize>minimized_combat</minimize>
		<tooltip>
			<field>name</field>
		</tooltip>
		<sheetdata>
			<stringfield name="name">
				<bounds>20,17,210,25</bounds>
				<font>titlefont</font>
				<tabtarget>
					<prev>description</prev>
					<next>count</next>
				</tabtarget>
				<frame>
					<name>sheetgroup</name>
				<offset>10,7,3,-1</offset>
				</frame>
				<center />
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</stringfield>

			<stringcontrol name="initmodlabel">
				<bounds>16,53,45,20</bounds>
				<font>sheetlabelinline</font>
				<static>Initiative</static>
			</stringcontrol>

			<numberfield name="initmodnum" source="initmodnum.base">
				<bounds>15,36,35,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,-2,1,1</offset>
				</frame>
				<font>sheettext</font>
				<tabtarget>
					<prev>name</prev>
					<next>valuesp</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>

			<stringcontrol name="activelabel">
				<bounds>85,44,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Active?:</static>
			</stringcontrol>

			<checkbox name="activebox">
				<bounds>120,38,25,25</bounds>
			</checkbox>

			<stringcontrol name="scnoteslabel">
				<bounds>175,46,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Notes:</static>
			</stringcontrol>

			<windowreferencefield name="defense_notes_shortcut">
				<bounds>195,43,40,20</bounds>
				<icon>
					<normal>button_openwindow</normal>
					<empty>button_emptytarget</empty>
					<pressed>button_emptytarget</pressed>
				</icon>
				<allowdrop />
			</windowreferencefield>


<!--VS DEF--><!--{{{-->
			<genericcontrol name="defenseframe">
				<bounds>10,64,160,40</bounds>
				<frame>
					<name>modifier</name>
				</frame>
			</genericcontrol>
			<stringcontrol name="deflabel">
				<anchored>
					<to>defenseframe</to>
					<position>insidetop</position>
					<offset>-45,5</offset>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>vs Defense:</static>
			</stringcontrol>


			<stringcontrol name="phydeflabel">
				<bounds>17,82,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Physical:</static>
			</stringcontrol>
			<numberfield name="physicaldefensenum" source="physicaldefensenum.base">
				<bounds>55,78,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>

			
			<stringcontrol name="spelldeflabel">
				<bounds>75,82,25,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Spell:</static>
			</stringcontrol>
			<numberfield name="spelldefensenum" source="spelldefensenum.base">
				<bounds>101,78,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
			
			<stringcontrol name="socialdeflabel">
				<bounds>120,82,25,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Social:</static>
			</stringcontrol>
			<numberfield name="socialdefensenum" source="socialdefensenum.base">
				<bounds>148,78,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
<!--}}}-->

<!--VS ARMOR--><!--{{{-->
			<genericcontrol name="armorframe">
				<bounds>10,104,160,40</bounds>
				<frame>
					<name>modifier</name>
				</frame>
			</genericcontrol>
			<stringcontrol name="armorlabel">
				<anchored>
					<to>armorframe</to>
					<position>insidetop</position>
					<offset>-45,5</offset>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>vs Armor:</static>
			</stringcontrol>


			<stringcontrol name="phyarmorlabel">
				<bounds>17,122,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Physical:</static>
			</stringcontrol>
			<numberfield name="physicalarmornum" source="physicalarmornum.base">
				<bounds>55,118,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
			
			<stringcontrol name="mysticarmorlabel">
				<bounds>75,122,30,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Mystic:</static>
			</stringcontrol>
			<numberfield name="mysticarmornum" source="mysticarmornum.base">
				<bounds>108,118,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
			
<!--}}}-->

<!-- Strain --> <!--{{{-->
			<genericcontrol name="defenseframe">
				<bounds>167,64,69,80</bounds>
				<frame>
					<name>modifier</name>
				</frame>
			</genericcontrol>
			<stringcontrol name="strainlabel">
				<bounds>184,69,40,20</bounds>
				<font>sheetlabelinline</font>
				<static>STRAIN</static>
			</stringcontrol>

			<numberfield name="attackstrain"><!--{{{-->
				<bounds>175,79,25,25</bounds>
				<tabtarget>
					<prev>rank</prev>
					<next>disciplinename</next>
				</tabtarget>
				<frame>
					<name>modifier</name>
					<offset>3,3,3,3</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>3,3,3,3</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<tooltip>attackstrain</tooltip>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.getDatabaseNode().getParent().getParent().getChild("health.damage").setValue(window.getDatabaseNode().getParent().getParent().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.woundthreshold.total").getValue() then
							window.getDatabaseNode().getParent().getParent().getChild("health.wounds").setValue(window.getDatabaseNode().getParent().getParent().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Wound [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						end
						if window.getDatabaseNode().getParent().getParent().getChild("totdamage").getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						elseif window.getDatabaseNode().getParent().getParent().getChild("totdamage").getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onGainFocus()
						setColor("#FF990099");
						setFrame("sheetfocus", 3, 3, 3, 3);
					end
					
					function onLoseFocus()
						setColor(nil);
						setFrame("modifier", 3, 3, 3, 3);
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 3, 3, 3, 3);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 3, 3, 3, 3);
							end
						end
					end
				</script>
			</numberfield><!--}}}-->

			<numberfield name="damagestrain"><!--{{{-->
				<bounds>203,79,25,25</bounds>
				<tabtarget>
					<prev>rank</prev>
					<next>disciplinename</next>
				</tabtarget>
				<frame>
					<name>modifier</name>
					<offset>3,3,3,3</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>3,3,3,3</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<tooltip>damagestrain</tooltip>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.getDatabaseNode().getParent().getParent().getChild("health.damage").setValue(window.getDatabaseNode().getParent().getParent().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.woundthreshold.total").getValue() then
							window.getDatabaseNode().getParent().getParent().getChild("health.wounds").setValue(window.getDatabaseNode().getParent().getParent().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Wound [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						end
						if window.getDatabaseNode().getParent().getParent().getChild("totdamage").getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						elseif window.getDatabaseNode().getParent().getParent().getChild("totdamage").getValue() &gt;= window.getDatabaseNode().getParent().getParent().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.getDatabaseNode().getParent().getParent().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onGainFocus()
						setColor("#FF990099");
						setFrame("sheetfocus", 3, 3, 3, 3);
					end
					
					function onLoseFocus()
						setColor(nil);
						setFrame("modifier", 3, 3, 3, 3);
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 3, 3, 3, 3);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 3, 3, 3, 3);
							end
						end
					end
				</script>
			</numberfield><!--}}}-->

			<stringcontrol name="strainonattacklabel">
				<bounds>181,107,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Attack:</static>
			</stringcontrol>
			<checkbox name="strainonattack">
				<bounds>210,100,25,25</bounds>
				<script>
					function onInit()
						super.onInit();
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
						else
							window.attackstrain.setVisible(false);
						end
					end
					function onClickDown(button, x, y)
						setState(not getState());
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
						else
							window.attackstrain.setVisible(false);
						end
					end
				</script>
			</checkbox>
			
			<stringcontrol name="strainondamagelabel">
				<bounds>175,122,75,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Damage:</static>
			</stringcontrol>
			<checkbox name="strainondamage">
				<bounds>210,115,25,25</bounds>
				<script>
					function onInit()
						super.onInit();
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
						else
							window.damagestrain.setVisible(false);
						end
					end
					function onClickDown(button, x, y)
						setState(not getState());
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
						else
							window.damagestrain.setVisible(false);
						end
					end
				</script>
			</checkbox>
<!--}}}-->

<!--VS HEALTH--><!--{{{-->
			<genericcontrol name="healthframe">
				<bounds>10,145,-14,40</bounds>
				<frame>
					<name>modifier</name>
				</frame>
			</genericcontrol>
			<stringcontrol name="healthlabel">
				<anchored>
					<to>healthframe</to>
					<position>insidetop</position>
					<offset>-85,5</offset>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>vs Health:</static>
			</stringcontrol>


			<stringcontrol name="wndthreshlabel">
				<bounds>17,163,75,20</bounds>
				<font>sheetlabelsmall</font>
				<static>Wnd Thr:</static>
			</stringcontrol>
			<numberfield name="wndthreshnum" source="wndthreshnum.base">
				<bounds>63,159,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>

			
			<stringcontrol name="unconlabel">
				<bounds>85,163,75,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Unconscious:</static>
			</stringcontrol>
			<numberfield name="unconnum" source="unconnum.base">
				<bounds>145,159,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
			
			<stringcontrol name="deathlabel">
				<bounds>170,163,35,25</bounds>
				<font>sheetlabelsmall</font>
				<static>Death:</static>
			</stringcontrol>
			<numberfield name="deathnum" source="deathnum.base">
				<bounds>203,159,15,20</bounds>
				<frame>
					<name>textline</name>
					<offset>1,1,1,1</offset>
				</frame>
				<font>sheetlabelsmall</font>
				<tabtarget>
					<prev>circle</prev>
					<next>weavethread</next>
				</tabtarget>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
				</script>
			</numberfield>
<!--}}}-->



			<stringcontrol name="descriptionlabel">
				<bounds>15,185,75,20</bounds>
				<font>sheetlabel</font>
				<static>Description:</static>
			</stringcontrol>

			<genericcontrol name="frame">
				<bounds>5,180,235,180</bounds>
			</genericcontrol>
			
			<stringfield name="description">
				<anchored>
					<to>frame</to>
					<position>over</position>
					<offset>-14,-19</offset>
				</anchored>
				<multilinespacing>12</multilinespacing>
				<font>chatfont</font>
				<tabtarget>
					<prev>totalweight</prev>
					<next>name</next>
				</tabtarget>
			</stringfield>
			<closebutton_charsheet />
			
		</sheetdata>
	</windowclass><!--}}}-->

</root>
