<?xml version="1.0" encoding="iso-8859-1"?>
<root version="2.0">

	<windowclass name="charsheet_combat">
		<placement>
			<size>
				<width>252</width>
				<height>611</height>
			</size>
		</placement>
		<nodelete />
		<sheetdata>

<!--Portrait--><!--{{{-->
			<genericcontrol>
				<bounds>335,30,100,100</bounds>
				<icon>charlist_base</icon>
				<disabled />
			</genericcontrol>        
            <portrait_charlocal name="localportrait">
				<bounds>335,30,100,100</bounds>
				<invisible />
			</portrait_charlocal>
			<portrait_char name="portrait">
				<bounds>335,30,100,100</bounds>
			</portrait_char>
            
   			<tokenfield name="token">
				<bounds>425,45,70,70</bounds>
				<empty>token_empty</empty>
				<tooltip text="Token" />
			</tokenfield>

<!--
			<buttoncontrol name="rk_modifiers">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>55</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>25</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_moduleunloaded</normal>
					<hover>indicator_moduleloading</hover>
					<pressed>indicator_moduleloaded</pressed>
				</icon> 	
				<script>
					function onButtonPress()
						win = Interface.openWindow("rk_modifiers",window.getDatabaseNode());
						win.label.setValue("Modifiers");
						win.label.setReadOnly(true);
					end
				</script>
			</buttoncontrol>
-->
<!--}}}-->

<!-- DISCIPLINES --><!--{{{-->
<!-- DISCIPLINE FRAME--><!--{{{-->
			<genericcontrol name="discframe">
				<bounds>15,40,330,85</bounds>
				<frame>
					<name>sheetgroup</name>
				</frame>
			</genericcontrol>
			
			<stringcontrol name="disclabel">
				<anchored>
					<to>discframe</to>
					<position>above</position>
					<offset>-128,-8</offset>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>10,5,3,5</offset>
				</frame>
				<font>titlefont</font>
				<static>Disciplines</static>
			</stringcontrol><!--}}}-->

<!-- DISCIPLINE HEADERS --><!--{{{-->
			<stringcontrol name="disclabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>10,10</offset>
					<size>
						<width>55</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Discipline</static>
			</stringcontrol>
			
			<stringcontrol name="circlelabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>120,10</offset>
					<size>
						<width>38</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Circle</static>
			</stringcontrol>
			<stringcontrol name="karmalabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>185,10</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Karma</static>
			</stringcontrol>
			<stringcontrol name="discnoteslabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>280,10</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Notes</static>
			</stringcontrol>
			<stringcontrol name="karmacostlabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>160,20</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Cost</static>
			</stringcontrol>
			<stringcontrol name="karmamaxlabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>192,20</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Max</static>
			</stringcontrol>
			<stringcontrol name="karmacurrlabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>220,20</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Curr</static>
			</stringcontrol>
			<stringcontrol name="karmasteplabel">
				<anchored>
					<to>discframe</to>
					<position>insidetopleft</position>
					<offset>250,20</offset>
					<size>
						<width>35</width>
					</size>
				</anchored>
				<font>sheetlabelsmallbold</font>
				<static>Step</static>
			</stringcontrol>
<!--}}}-->

<!--DISCIPLINE LIST--><!--{{{-->
			<windowlist name="disclist">
				<anchored>
					<to>discframe</to>
					<position>over</position>
					<offset>-12,-9</offset>
					<top>
						<parent>discframe</parent>
						<offset>30</offset>
					</top>
				</anchored>

				<datasource>.discipline</datasource>
				<class>discipline_listitem</class>
				<allowcreate />
				<allowdelete />
				<skipempty />
				<script>
					function onSortCompare(w1, w2)
						if w1.name.getValue() == "" then
							return true;
						elseif w2.name.getValue() == "" then
							return false;
						end
					
						return w1.name.getValue() &gt; w2.name.getValue();
					end
				</script>
			</windowlist>
            <scrollbar>
				<target>disclist</target>
                <anchored to="disclist" />                
            </scrollbar>
<!--}}}-->

<!-- Attacks --><!--{{{-->
			<genericcontrol name="attackframe">
				<bounds>15,125,480,165</bounds>
				<frame>
					<name>sheetgroup</name>
				</frame>
			</genericcontrol>
			
			<stringcontrol name="attacklabel">
				<anchored>
					<to>attackframe</to>
					<position>above</position>
					<offset>-212,-8</offset>
				</anchored>
				<frame>
					<name>modifier</name>
				<offset>5,5,5,5</offset>
				</frame>
				<font>titlefont</font>
				<static>Attacks</static>
				<center />
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>10,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Description:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>155,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Attack</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>158,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Step</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>190,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Damage</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>197,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Step</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>237,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Defense</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>234,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Ph:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>250,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Sp:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>266,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>So:</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>285,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Damage</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>287,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Ph:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>305,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>My:</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>326,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Range:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>379,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Strain:</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>379,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>At:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>396,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Da:</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>413,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Full:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>attackframe</to>
					<position>insidetopleft</position>
					<offset>437,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Notes:</static>
			</stringcontrol>
			
			<windowlist name="attacklist">
				<anchored>
					<to>attackframe</to>
					<position>over</position>
					<offset>-15,-9</offset>
					<top>
						<parent>attackframe</parent>
						<offset>35</offset>
					</top>
				</anchored>
				<datasource>.attacks</datasource>
				<class>attack_listitem</class>
				<allowcreate />
				<allowdelete />
				<skipempty />
				<script>
					function onSortCompare(w1, w2)
						returnValue = w1.name.getValue() &gt; w2.name.getValue();
						return returnValue;
					end
				</script>
			</windowlist>
            <scrollbar>
				<target>attacklist</target>
                <anchored to="attacklist" />
            </scrollbar>			

<!-- Defenses --><!--{{{-->
			<genericcontrol name="defenseframe">
				<bounds>15,290,480,165</bounds>
				<frame>
					<name>sheetgroup</name>
				</frame>
			</genericcontrol>
			
			<stringcontrol name="defenselabel">
				<anchored>
					<to>defenseframe</to>
					<position>above</position>
					<offset>-208,-8</offset>
				</anchored>
				<frame>
					<name>modifier</name>
				<offset>5,5,5,5</offset>
				</frame>
				<font>titlefont</font>
				<static>Defenses</static>
				<center />
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>9,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Active:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>43,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Name:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>218,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Defense</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>204,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Ph:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>230,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Sp:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>256,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>So:</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>292,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Armor</static>
			</stringcontrol>
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>285,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Ph:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>311,21</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>My:</static>
			</stringcontrol>

			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>332,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Init Mod:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>379,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Strain:</static>
			</stringcontrol>

			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>413,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Full:</static>
			</stringcontrol>
			
			<stringcontrol>
				<anchored>
					<to>defenseframe</to>
					<position>insidetopleft</position>
					<offset>437,12</offset>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Notes:</static>
			</stringcontrol>
			
			<windowlist name="defenselist">
				<anchored>
					<to>defenseframe</to>
					<position>over</position>
					<offset>-12,-9</offset>
					<top>
						<parent>defenseframe</parent>
						<offset>35</offset>
					</top>
				</anchored>
				<datasource>.defenses</datasource>
				<class>defense_listitem</class>
				<allowcreate />
				<allowdelete />
				<skipempty />
				<script>
					function onSortCompare(w1, w2)
						returnValue = w1.name.getValue() &gt; w2.name.getValue();
						return returnValue;
					end
					function total(source)
						if not updatingdef then
							updatingdef = true;
							--[[print("update defenselist");]]
							local tempinit = 0;
							local tempphdef = 0;
							local tempspdef = 0;
							local tempsodef = 0;
							local temppharm = 0;
							local tempmyarm = 0;
							local tempthreshnum = 0;
							local tempunconnum = 0;
							local tempdeathnum = 0;
							local templist = source.getChildren();
							for i in pairs(templist) do
								if templist[i].getChild("activebox") then
									if templist[i].getChild("activebox").getValue() == 1 then
										if templist[i].getChild("initmodnum.total") then
											tempinit = tempinit + templist[i].getChild("initmodnum.total").getValue();
										end
										if templist[i].getChild("physicaldefensenum.total") then
											tempphdef = tempphdef + templist[i].getChild("physicaldefensenum.total").getValue();
										end
										if templist[i].getChild("spelldefensenum.total") then
											tempspdef = tempspdef + templist[i].getChild("spelldefensenum.total").getValue();
										end
										if templist[i].getChild("socialdefensenum.total") then
											tempsodef = tempsodef + templist[i].getChild("socialdefensenum.total").getValue();
										end
										if templist[i].getChild("physicalarmornum.total") then
											temppharm = temppharm + templist[i].getChild("physicalarmornum.total").getValue();
										end
										if templist[i].getChild("mysticarmornum.total") then
											tempmyarm = tempmyarm + templist[i].getChild("mysticarmornum.total").getValue();
										end
										if templist[i].getChild("wndthreshnum.base") then
											tempthreshnum = tempthreshnum + templist[i].getChild("wndthreshnum.base").getValue();
										end
										if templist[i].getChild("unconnum.base") then
											tempunconnum = tempunconnum + templist[i].getChild("unconnum.base").getValue();
										end
										if templist[i].getChild("deathnum.base") then
											tempdeathnum = tempdeathnum + templist[i].getChild("deathnum.base").getValue();
										end
									end
								end
							end
							if tempinit ~= window.getDatabaseNode().getChild("initmod.def.base").getValue() then
								window.getDatabaseNode().getChild("initmod.def.base").setValue(tempinit);
								--[[print("updating tempinit to " .. tempinit);]]
							else
								--[[print("not updating tempinit");]]
							end
							if tempphdef ~= window.getDatabaseNode().getChild("phydefnum.def.base").getValue() then
								window.getDatabaseNode().getChild("phydefnum.def.base").setValue(tempphdef);
								--[[print("updating tempphdef to " .. tempphdef);]]
							else
								--[[print("not updating tempphdef");]]
							end
							if tempspdef ~= window.getDatabaseNode().getChild("spdefnum.def.base").getValue() then
								window.getDatabaseNode().getChild("spdefnum.def.base").setValue(tempspdef);
								--[[print("updating tempspdef to " .. tempspdef);]]
							else
								--[[print("not updating tempspdef");]]
							end
							if tempsodef ~= window.getDatabaseNode().getChild("sodefnum.def.base").getValue() then
								window.getDatabaseNode().getChild("sodefnum.def.base").setValue(tempsodef);
								--[[print("updating tempsodef to " .. tempsodef);]]
							else
								--[[print("not updating tempsodef");]]
							end
							if temppharm ~= window.getDatabaseNode().getChild("pharmnum.def.base").getValue() then
								window.getDatabaseNode().getChild("pharmnum.def.base").setValue(temppharm);
								--[[print("updating temppharm to " .. temppharm);]]
							else
								--[[print("not updating temppharm");]]
							end
							if tempmyarm ~= window.getDatabaseNode().getChild("myarmnum.def.base").getValue() then
								window.getDatabaseNode().getChild("myarmnum.def.base").setValue(tempmyarm);
								--[[print("updating tempmyarm to " .. tempmyarm);]]
							else
								--[[print("not updating tempmyarm");]]
							end
							if tempthreshnum ~= window.getDatabaseNode().getChild("health.threshnum.base").getValue() then
								window.getDatabaseNode().getChild("health.threshnum.base").setValue(tempthreshnum);
								--[[print("updating tempthreshnum to " .. tempthreshnum);]]
							else
								--[[print("not updating tempthreshnum");]]
							end
							if tempunconnum ~= window.getDatabaseNode().getChild("health.unconnum.base").getValue() then
								window.getDatabaseNode().getChild("health.unconnum.base").setValue(tempunconnum);
								--[[print("updating tempunconnum to " .. tempunconnum);]]
							else
								--[[print("not updating tempunconnum");]]
							end
							if tempdeathnum ~= window.getDatabaseNode().getChild("health.deathnum.base").getValue() then
								window.getDatabaseNode().getChild("health.deathnum.base").setValue(tempdeathnum);
								--[[print("updating tempdeathnum to " .. tempdeathnum);]]
							else
								--[[print("not updating tempdeathnum");]]
							end
							updatingdef = false;
						end
					end

					local updatingdefx = false;
					function onChildUpdatex()
						local source = getDatabaseNode();
						if not updating then
							updatingdefx = true;
							total(source);
							updatingdefx = false;
						end
					end


					function onInit()
						local source = getDatabaseNode();
						source.onChildUpdate = onChildUpdatex;
						updatingdef = false;
						total(source);
					end


				</script>
			</windowlist>
            <scrollbar>
				<target>defenselist</target>
                <anchored to="defenselist" />                
            </scrollbar>

<!-- CHARFRAME--><!--{{{--><!--{{{-->
			<genericcontrol name="charframe">
				<bounds>15,452,480,98</bounds>
				<frame>
					<name>sheetgroup</name>
				</frame>
			</genericcontrol>
<!--}}}-->

<!-- INITIATIVE -->	<!--{{{-->
			<stringcontrol name="initlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>403,10</offset>
					<size>
						<width>65</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>10,5,5,35</offset>
				</frame>

				<font>titlefont</font>
				<static>Initiative</static>
			</stringcontrol>
			<stepcontrol_mod_ns name="initstep" source="init.step.total">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>432,27</offset>
					<size>
						<height>25</height>
						<width>25</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>Initiative</description>
				<modifierfield>init.step.temp</modifierfield>
				<source>
					<name>initmod.def.base</name>
					<op>+</op>
				</source>
				<source>
					<name>attributes.dexterity.step</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							diestring = "";
							dice = {};
							mod = 0;
							dice, mod = Step.getStepDice(getValue());
							for i=1,table.maxn(dice) do
								diestring = diestring .. dice[i] .. "+";
							end
							if mod &lt; 0 then
								diestring = string.sub(diestring,1,string.len(diestring)-1) .. mod;
							else
								diestring = string.sub(diestring,1,string.len(diestring)-1);
							end
							dieWidget.setPosition("left", -20, 0);
							dieWidget.setText(diestring);
							dieWidget.setVisible(true);
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
							dieWidget.setVisible(false);
						end
					end
				</script>
			</stepcontrol_mod_ns><!--}}}-->
			
<!-- ARMOR -->					<!--{{{-->
			<stringcontrol name="armorlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>240,10</offset>
					<size>
						<width>60</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>20,5,100,35</offset>
				</frame>
				<font>titlefont</font>
				<static>Armor</static>
			</stringcontrol>
			
			<stringcontrol name="palabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>233,27</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Physical</static>
			</stringcontrol>
			<modifiernumber name="physicalarmor" source="armor.physical.total">
				<anchored>
					<to>palabel</to>
					<position>right</position>
					<offset>5,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>acicon_small</name>
					<offset>3,3,1,1</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Physical Armor</text>
				</description>
				<modifierfield>armor.physical.temp</modifierfield>
				<source>
					<name>pharmnum.def.base</name>
					<op>+</op>
				</source>
				<source>
					<name>armortotal.totalpa</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
						else
							if hasFocus() == false then
								setColor(nil);
							end
						end
					end
					function onDrop(x, y, draginfo)
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						if draginfo.getType() == "number" then
							currentDamage = draginfo.getNumberData() - getValue();
							if currentDamage &lt;= 0 then
								currentDamage = 0;
							end
							ChatManager.control.deliverMessage({ icon = "indicator_shield", font = "narratorfont", text = "[" .. userguy .. "]" .. ": Physical Armor Applied vs " .. draginfo.getDescription() .. " (" .. draginfo.getNumberData() .. " - " .. getValue() .. " = " .. currentDamage .. ") --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
							draginfo.setDescription("Total: " .. currentDamage);
							draginfo.setNumberData(currentDamage);
							window.damage.onDrop(x, y, draginfo)
						end
						return true;
					end

				</script>
			</modifiernumber>
			
			<stringcontrol name="malabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>318,27</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Mystic</static>
			</stringcontrol>
			
			<numberfield name="mysticbase" source="armor.mystic.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						setValue(Lookup.getMA(willnode.getValue()));
					end
					function onInit()
						willnode = window.getDatabaseNode().getChild("attributes.willpower.base");
						willnode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="mysticarmor" source="armor.mystic.total">
				<anchored>
					<to>malabel</to>
					<position>right</position>
					<offset>0,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>acicon_small</name>
					<offset>3,3,1,1</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Mystic Armor</text>
				</description>
				<modifierfield>armor.mystic.temp</modifierfield>
				<source>
					<name>myarmnum.def.base</name>
					<op>+</op>
				</source>
				<source>
					<name>armor.mystic.base</name>
					<op>+</op>
				</source>
				<source>
					<name>armortotal.totalma</name>
					<op>+</op>
				</source>
				<script>
					function onDrop(x, y, draginfo)
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						if draginfo.getType() == "number" then
							currentDamage = draginfo.getNumberData() - getValue();
							if currentDamage &lt;= 0 then
								currentDamage = 0;
							end
							ChatManager.control.deliverMessage({ icon = "indicator_powertype_aura", font = "narratorfont", text = "[" .. userguy .. "]" .. ": Mystic Armor Applied vs " .. draginfo.getDescription() .. " (" .. draginfo.getNumberData() .. " - " .. getValue() .. " = " .. currentDamage .. ") --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
							draginfo.setDescription("Total: " .. currentDamage);
							draginfo.setNumberData(currentDamage);
							window.damage.onDrop(x, y, draginfo)
						end
						return true;
					end
					function onHover(state)
						if state then
							setColor("#FF228822");
						else
							if hasFocus() == false then
								setColor(nil);
							end
						end
					end
				</script>
			</modifiernumber> <!--}}}-->

<!-- DEFENSE -->			<!--{{{-->
			<stringcontrol name="deflabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>27,10</offset>
					<size>
						<width>60</width>
					</size>
		
				</anchored>
					<frame>
						<name>modifier</name>
						<offset>20,5,140,35</offset>
					</frame>
				<font>titlefont</font>
				<static>Defense</static>
			</stringcontrol>
			
			<stringcontrol name="pdlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>14,27</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Physical</static>
			</stringcontrol>
			<numberfield name="physbase" source="defense.physical.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						setValue(Lookup.getDef(dexnode.getValue()));
					end
					function onInit()
						dexnode = window.getDatabaseNode().getChild("attributes.dexterity.base");
						dexnode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="physicaldefense" source="defense.physical.total">
				<anchored>
					<to>pdlabel</to>
					<position>right</position>
					<offset>0,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Physical Defense</text>
				</description>
				<modifierfield>defense.physical.temp</modifierfield>
				<source>
					<name>defense.physical.base</name>
					<op>+</op>
				</source>
				<source>
					<name>phydefnum.def.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</modifiernumber>
			
			<stringcontrol name="spdlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>94,27</offset>
					<size>
						<width>32</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Spell</static>
			</stringcontrol>
			<numberfield name="spellbase" source="defense.spell.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						setValue(Lookup.getDef(pernode.getValue()));
					end
					function onInit()
						pernode = window.getDatabaseNode().getChild("attributes.perception.base");
						pernode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="spelldefense" source="defense.spell.total">
				<anchored>
					<to>spdlabel</to>
					<position>right</position>
					<offset>0,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Spell Defense</text>
				</description>
				<modifierfield>defense.spell.temp</modifierfield>
				<source>
					<name>defense.spell.base</name>
					<op>+</op>
				</source>
				<source>
					<name>spdefnum.def.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</modifiernumber>
			
			<stringcontrol name="sdlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>154,27</offset>
					<size>
						<width>40</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Social</static>
			</stringcontrol>
			<numberfield name="socialbase" source="defense.social.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						setValue(Lookup.getDef(chanode.getValue()));
					end
					function onInit()
						chanode = window.getDatabaseNode().getChild("attributes.charisma.base");
						chanode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="socialdefense" source="defense.social.total">
				<anchored>
					<to>sdlabel</to>
					<position>right</position>
					<offset>0,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Social Defense</text>
				</description>
				<modifierfield>defense.social.temp</modifierfield>
				<source>
					<name>defense.social.base</name>
					<op>+</op>
				</source>
				<source>
					<name>sodefnum.def.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
						

<!-- MOVE --><!--{{{-->
			<stringcontrol name="movelabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>27,65</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>20,10,80,10</offset>
				</frame>
				<font>titlefont</font>
				<static>Move</static>
			</stringcontrol>
			
			<labelednumber name="combatmove" source="move.combat">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>75,60</offset>
					<size>
						<height>20</height>
						<width>40</width>
					</size>
				</anchored>
				<label>combat</label>
				<center />
				<script>
					function onHover(state)
						if state then
							setColor("#FF990099");
						else
							if hasFocus() == false then
								setColor(nil);
							end
						end
					end
				</script>
			</labelednumber>
			<labelednumber name="fullmove" source="move.full">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>125,60</offset>
					<size>
						<height>20</height>
						<width>20</width>
					</size>
				</anchored>
				<label>full</label>
				<center />
				<script>
					function onHover(state)
						if state then
							setColor("#FF990099");
						else
							if hasFocus() == false then
								setColor(nil);
							end
						end
					end
				</script>
			</labelednumber><!--}}}--><!--}}}-->

<!--Vitals--><!--{{{-->
			<stringcontrol name="damlabel">
				<anchored>
					<to>charframe</to>
					<position>insidetopleft</position>
					<offset>177,65</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>25,10,246,10</offset>
				</frame>
				<font>titlefont</font>
			</stringcontrol>


<!--Wound Threshold --><!--{{{-->
			<stringcontrol name="threshlabel">
				<anchored>
					<to>damlabel</to>
					<position>insideleft</position>
					<offset>-5,0</offset>
					<size>
						<width>60</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Wnd Thr:</static>
			</stringcontrol>
			<numberfield name="threshbase" source="health.woundthreshold.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						death,uncon,wound,rec = Lookup.getHealth(tounode.getValue());
						setValue(wound);
					end
					function onInit()
						tounode = window.getDatabaseNode().getChild("attributes.toughness.base");
						tounode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="threshold" source="health.woundthreshold.total">
				<anchored>
					<to>threshlabel</to>
					<position>right</position>
					<offset>5,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Wound Threshold</text>
				</description>
				<modifierfield>health.woundthreshold.temp</modifierfield>
				<source>
					<name>health.woundthreshold.base</name>
					<op>+</op>
				</source>
				<source>
					<name>health.threshnum.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
				
			</modifiernumber><!--}}}-->

<!-- Unconscious --><!--{{{-->
			<stringcontrol name="unconlabel">
				<anchored>
					<to>damlabel</to>
					<position>insideleft</position>
					<offset>90,0</offset>
					<size>
						<width>80</width>
					</size>
				</anchored>
				<font>sheettext</font>
				<static>Unconscious:</static>
			</stringcontrol>
			<numberfield name="unconbase" source="health.unconscious.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						death,uncon,wound,rec = Lookup.getHealth(tounode.getValue());
						setValue(uncon);
					end
					function onInit()
						tounode = window.getDatabaseNode().getChild("attributes.toughness.base");
						tounode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="unconscious" source="health.unconscious.total">
				<anchored>
					<to>unconlabel</to>
					<position>right</position>
					<offset>10,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Unconscious Rating</text>
				</description>
				<modifierfield>health.unconscious.temp</modifierfield>
				<source>
					<name>health.unconscious.base</name>
					<op>+</op>
				</source>
				<source>
					<name>health.uncon.dur</name>
					<op>+</op>
				</source>
				<source>
					<name>health.unconnum.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
			
<!-- Death --><!--{{{-->
			<stringcontrol name="deathlabel">
				<anchored>
					<to>damlabel</to>
					<position>insideleft</position>
					<offset>210,0</offset>
				</anchored>
				<font>sheettext</font>
				<static>Death:</static>
			</stringcontrol>
			<numberfield name="deathbase" source="health.death.base">
				<bounds>0,0,1,1</bounds>
				<font>sheetnumber</font>
				<invisible />
				<script>
					function update()
						death,uncon,wound,rec = Lookup.getHealth(tounode.getValue());
						setValue(death);
					end
					function onInit()
						tounode = window.getDatabaseNode().getChild("attributes.toughness.base");
						tounode.onUpdate = update;
						update();
					end
				</script>
			</numberfield>
			<modifiernumber name="death" source="health.death.total">
				<anchored>
					<to>deathlabel</to>
					<position>right</position>
					<offset>10,0</offset>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Death Rating</text>
				</description>
				<modifierfield>health.death.temp</modifierfield>
				<source>
					<name>health.death.base</name>
					<op>+</op>
				</source>
				<source>
					<name>health.death.dur</name>
					<op>+</op>
				</source>
				<source>
					<name>health.deathnum.base</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
<!--}}}-->

<!-- DAMAGE --><!--{{{-->
<!-- DAMAGE FRAME --><!--{{{-->
			<genericcontrol name="damageframe">
				<bounds>15,546,480,50</bounds>
				<frame>
					<name>sheetgroup</name>
				</frame>
			</genericcontrol>
			<stringcontrol name="damagelabel">
				<anchored>
					<to>damageframe</to>
					<position>above</position>
					<offset>-210,-15</offset>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>10,5,3,5</offset>
				</frame>
				<font>titlefont</font>
				<static>Damage</static>
			</stringcontrol><!--}}}-->

<!-- TOTAL DAMAGE --><!--{{{-->
			<stringcontrol name="totdamagelabel">
				<anchored>
					<to>damageframe</to>
					<position>insideleft</position>
					<offset>20,-17</offset>
					<size>
						<width>36</width>
					</size>
				</anchored>
				<font>sheetlabel</font>
				<static>Total:</static>
			</stringcontrol>
	
			<linkednumber name="totdamage">
				<anchored>
					<to>totdamagelabel</to>
					<position>righthigh</position>
					<offset>5,-4</offset>
					<size>
						<height>25</height>
						<width>35</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<font>sheetnumber</font>
				<description>
					<text>Total Damage</text>
				</description>
				<source>
					<name>health.damage</name>
					<op>+</op>
				</source>
				<source>
					<name>health.bmdamage.base</name>
					<op>+</op>
				</source>
				<noreset />
				<readonly />
			</linkednumber><!--}}}-->

<!-- TAKEN DAMAGE --><!--{{{-->
			<stringcontrol name="takenlabel">
				<anchored>
					<to>damageframe</to>
					<position>insideleft</position>
					<offset>120,-17</offset>
					<size>
						<width>38</width>
					</size>
				</anchored>
				<font>sheetlabel</font>
				<static>Taken:</static>
			</stringcontrol>
	
			<numberfield name="damage" source="health.damage">
				<anchored>
					<to>takenlabel</to>
					<position>righthigh</position>
					<offset>5,-4</offset>
					<size>
						<height>25</height>
						<width>35</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>5,5,5,5</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<description>
					<text>Damage Taken</text>
				</description>
				<script>
					function onDrop(x, y, draginfo)
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						if draginfo.getType() == "number" then
							currentDamage = getValue() + draginfo.getNumberData();
							if currentDamage &lt;= 0 then
								currentDamage = 0;
							end
							setValue(currentDamage);
							if draginfo.getNumberData() ~= 0  then
								if draginfo.getNumberData() &gt; 0 then
									effecttext = "Damage";
								else
									effecttext = "Healing";
								end

								ChatManager.control.deliverMessage({ icon = "indicator_damage", font = "narratorfont", text = "[" .. userguy .. "]" .. ": " .. effecttext .. " [" .. draginfo.getDescription() .. "] --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
								if draginfo.getNumberData() &gt; window.threshold.getValue() then
									newWounds = window.wounddamage.getValue() + 1;
									window.wounddamage.setValue(newWounds);
									ChatManager.control.deliverMessage({ icon = "indicator_damage", font = "narratorfont", text = "[" .. userguy .. "]" .. ": Wound [" .. draginfo.getDescription() .. "] --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
								end
								if window.totdamage.getValue() &gt;= window.death.getValue() then
									ChatManager.control.deliverMessage({ icon = "indicator_effect", font = "narratorfont", text = "[" .. userguy .. "]" .. ": Dead [" .. draginfo.getDescription() .. "] --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
								elseif window.totdamage.getValue() &gt;= window.unconscious.getValue() then
									ChatManager.control.deliverMessage({ icon = "indicator_effect", font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. draginfo.getDescription() .. "] --> " .. window.getDatabaseNode().getChild("name").getValue(), mode = "emote" });
								end
							end
						end
						return true;
					end
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
					function onHover(state)
						if state then
							setColor("#FF990099");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</numberfield>
<!--}}}-->
	
<!-- BLOOD DAMAGE --><!--{{{-->
			<stringcontrol name="bmlabel">
				<anchored>
					<to>damageframe</to>
					<position>insideleft</position>
					<offset>220,-17</offset>
					<size>
						<width>80</width>
					</size>
				</anchored>
				<font>sheetlabel</font>
				<static>Blood Magic:</static>
			</stringcontrol>
			<linkednumber name="bmdamage" source="health.bmdamage.base">
				<anchored>
					<to>bmlabel</to>
					<position>righthigh</position>
					<offset>5,-4</offset>
					<size>
						<height>25</height>
						<width>35</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<readonly />
				<font>sheetnumber</font>
				<description>
					<text>Blood Magic</text>
				</description>
				<source>
					<name>health.bmdamage.tmp</name>
					<op>+</op>
				</source>
				<script>
					function onHover(state)
						if state then
							setColor("#FF990099");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</linkednumber><!--}}}-->

<!-- WOUNDS --><!--{{{-->
			<stringcontrol name="woundlabel">
				<anchored>
					<to>damageframe</to>
					<position>insideleft</position>
					<offset>370,-17</offset>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<font>sheetlabel</font>
				<static>Wounds:</static>
			</stringcontrol>
	
			<numberfield name="wounddamage" source="health.wounds">
				<anchored>
					<to>woundlabel</to>
					<position>righthigh</position>
					<offset>5,-4</offset>
					<size>
						<height>25</height>
						<width>35</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>5,5,5,5</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>5,5,5,5</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<description>
					<text>Wounds</text>
				</description>
				<script>
					function onGainFocus()
						setColor("#FF990099");
					end
					
					function onLoseFocus()
						setColor(nil);
					end
					function onHover(state)
						if state then
							setColor("#FF990099");
							setFrame("sheetfocus", 5, 5, 5, 5);
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 5, 5, 5, 5);
							end
						end
					end
				</script>
			</numberfield><!--}}}-->

<!--}}}-->

	
		</sheetdata>
	</windowclass>
	
<!-- ATTACKS LIST ITEM -->	<!--{{{-->
	<windowclass name="attack_listitem">
		<sizelimits>
			<minimum>
				<height>20</height>
			</minimum>
		</sizelimits>
		<sheetdata>
			
			<textlistitemvalue name="name">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>0</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>135</width>
					</size>
				</anchored>
				<tabtarget>
					<next>disciplinename</next>
					<prev>circle</prev>
				</tabtarget>
				<font>sheettextsmall</font>
				<script>
					function onLoseFocus()
						super.onLoseFocus();
						window.windowlist.applySort();
					end
					function onDoubleClick()
						win = Interface.openWindow("attackfull",window.getDatabaseNode());
					end
				</script>
			</textlistitemvalue>
			<stringcontrol name="karmaonattacklabel">
				<bounds>0,0,0,0</bounds>
				<font>sheetlabelsmall</font>
				<static>Karma:</static>
				<invisible />
			</stringcontrol>
			<checkbox name="karmaonattack">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</checkbox>
			<checkbox name="karmaonattackvis">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</checkbox>
			<stringfield name="attackkarmaclass" source="attackkarmaclass">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</stringfield>
			<modifiernumber name="attackstep" source="attackstep.total">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>143</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>3,3,3,3</offset>
				</frame>
				<font>sheetnumber</font>
				<readonly />
				<source>
					<name>attackbonusonestep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonustwostep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonusthreestep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonusfourstep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonusfivestep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonussixstep</name>
					<op>+</op>
				</source>
				<source>
					<name>attackbonussevenstep</name>
					<op>+</op>
				</source>
				<modifierfield>attackstep.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onDrag(button,x,y,dragdata)
						dragdata.setType("dice");
						dragdata.setSlot(1);
						dice = {};
						mod = 0;
						dice, mod = Step.getStepDice(getValue());
						dragdata.setDieList(dice);
						
						dragdata.setDescription(window.name.getValue() .. " (Attack Step " .. getValue() .. ")" );
						dragdata.setNumberData(mod);
						
						return true;
					end	

					function onDoubleClick()
						dice = {};
						mod = 0;
						dice, mod = Step.getStepDice(getValue());

						attackkarmastep = 0;
						karmaaddedtext = "";

						if window.karmaonattackvis.getState() and window.karmaonattack.getState() then
							local node = window.getDatabaseNode().getParent().getParent();
							local source = node.getChild("discipline");
							local templist = source.getChildren();
							found = 0;
							attackkarmastep = 0;
							for i in pairs(templist) do
								if templist[i].getChild("name") then
									local discname = templist[i].getChild("name").getValue();
									if discname == window.attackkarmaclass.getValue() and found == 0 and templist[i].getChild("curr").getValue() &gt;= 1 then
										found = 1;
										attackkarmastep = templist[i].getChild("kstep").getValue();
										templist[i].getChild("curr").setValue(templist[i].getChild("curr").getValue() - 1);
										karmaaddedtext = " + Step " .. attackkarmastep .. " " .. window.attackkarmaclass.getValue() .. " Karma";
										
									end
								end
							end
							if attackkarmastep &gt;= 1 then
								dicea = {};
								dicea, mod = Step.getStepDice(attackkarmastep);
								for k,v in pairs(dicea) do 
									table.insert(dice, v) 
								end
							end
						end
						if window.strainonattack.getState() == true then
							window.attackstrain.onDoubleClick();
						end
						ChatManager.control.throwDice("dice",dice, mod, window.name.getValue() .. " (Attack Step " .. getValue() .. karmaaddedtext .. ")");
					end

					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 3, 3, 3, 3);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 3, 3, 3, 3);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber>
			<stringcontrol name="karmaondamagelabel">
				<bounds>0,0,0,0</bounds>
				<font>sheetlabelsmall</font>
				<static>Karma:</static>
				<invisible />
			</stringcontrol>
			<checkbox name="karmaondamage">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</checkbox>
			<checkbox name="karmaondamagevis">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</checkbox>
			<stringfield name="damagekarmaclass" source="damagekarmaclass">
				<invisible />
				<bounds>0,0,0,0</bounds>
			</stringfield>
			
			<modifiernumber name="damagestep" source="damagestep.total">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>182</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>3,3,3,3</offset>
				</frame>
				<font>sheetnumber</font>
				<readonly />
				<source>
					<name>damagebonusonestep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonustwostep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonusthreestep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonusfourstep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonusfivestep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonussixstep</name>
					<op>+</op>
				</source>
				<source>
					<name>damagebonussevenstep</name>
					<op>+</op>
				</source>
				<modifierfield>damagestep.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onDrag(button,x,y,dragdata)
						dragdata.setType("dice");
						dragdata.setSlot(1);
						dice = {};
						mod = 0;
						dice, mod = Step.getStepDice(getValue());
						dragdata.setDieList(dice);
						
						dragdata.setDescription(window.name.getValue() .. " (Damage Step " .. getValue() .. ")" );
						dragdata.setNumberData(mod);
						
						return true;
					end	
					function onDoubleClick()
						dice = {};
						mod = 0;
						dice, mod = Step.getStepDice(getValue());

						damagekarmastep = 0;
						karmaaddedtext = "";

						if window.karmaondamagevis.getState() and window.karmaondamage.getState() then
							local node = window.getDatabaseNode().getParent().getParent();
							local source = node.getChild("discipline");
							local templist = source.getChildren();
							found = 0;
							damagekarmastep = 0;
							for i in pairs(templist) do
								if templist[i].getChild("name") then
									local discname = templist[i].getChild("name").getValue();
									if discname == window.damagekarmaclass.getValue() and found == 0 and templist[i].getChild("curr").getValue() &gt;= 1 then
										found = 1;
										damagekarmastep = templist[i].getChild("kstep").getValue();
										templist[i].getChild("curr").setValue(templist[i].getChild("curr").getValue() - 1);
										karmaaddedtext = " + Step " .. damagekarmastep .. " " .. window.damagekarmaclass.getValue() .. " Karma";
										
									end
								end
							end
							if damagekarmastep &gt;= 1 then
								dicea = {};
								dicea, mod = Step.getStepDice(damagekarmastep);
								for k,v in pairs(dicea) do 
									table.insert(dice, v) 
								end
							end
						end
						if window.strainondamage.getState() == true then
							window.damagestrain.onDoubleClick();
						end
						ChatManager.control.throwDice("dice",dice, mod, window.name.getValue() .. " (Damage Step " .. getValue() .. karmaaddedtext .. ")");
					end


					function onHover(state)
						if state then
							setColor("#FF228822");
							setFrame("sheetfocus", 3, 3, 3, 3);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 3, 3, 3, 3);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber>

			<checkbox name="physicaldefense">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>219</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onClickDown()
						return false;
					end
				</script>
				<tooltip>
					<text>vs Physical Defense</text>
				</tooltip>
			</checkbox>
			
			<checkbox name="spelldefense">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>235</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onClickDown()
						return false;
					end
				</script>
				<tooltip>
					<text>vs Spell Defense</text>
				</tooltip>
			</checkbox>
			
			<checkbox name="socialdefense">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>251</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onClickDown()
						return false;
					end
				</script>
				<tooltip>
					<text>vs Social Defense</text>
				</tooltip>
			</checkbox>

			<checkbox name="physicalarmor">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>272</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onClickDown()
						return false;
					end
				</script>
				<tooltip>
					<text>vs Physical Armor</text>
				</tooltip>
			</checkbox>
			
			<checkbox name="mysticarmor">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>290</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onClickDown()
						return false;
					end
				</script>
				<tooltip>
					<text>vs Mystic Armor</text>
				</tooltip>
			</checkbox>
			
			
			<textlistitemvalue name="range">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>313</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>50</width>
					</size>
				</anchored>
				<tabtarget>
					<next>circle</next>
					<prev>name</prev>
				</tabtarget>
				<font>sheettextsmall</font>
				<empty>melee</empty>
			</textlistitemvalue>

			<checkbox name="strainonattack">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>366</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onInit()
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
							window.strainonattack.setVisible(false);
						else
							window.attackstrain.setVisible(false);
							window.strainonattack.setVisible(true);
						end
					end
					function onClickDown(button, x, y)
						return false;
					end
					function onValueChanged()
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
							window.strainonattack.setVisible(false);
						else
							window.attackstrain.setVisible(false);
							window.strainonattack.setVisible(true);
						end
					end
				</script>
			</checkbox>
			
			<checkbox name="strainondamage">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>384</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onInit()
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
							window.strainondamage.setVisible(false);
						else
							window.damagestrain.setVisible(false);
							window.strainondamage.setVisible(true);
						end
					end
					function onClickDown(button, x, y)
						return false;
					end
					function onValueChanged()
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
							window.strainondamage.setVisible(false);
						else
							window.damagestrain.setVisible(false);
							window.strainondamage.setVisible(true);
						end
					end
				</script>
			</checkbox>


			<numberfield name="attackstrain"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>363</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.windowlist.window.getDatabaseNode().getChild("health.damage").setValue(window.windowlist.window.getDatabaseNode().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Attack roll Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.woundthreshold.total").getValue() then
							window.windowlist.window.getDatabaseNode().getChild("health.wounds").setValue(window.windowlist.window.getDatabaseNode().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Attack roll Strain Wound [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
						if window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						elseif window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 2, 2, 2, 2);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 2, 2, 2, 2);
								window.setFrame(nil);
							end
						end
					end
					function onWheel()
						return true;
					end
				</script>
				<readonly />
			</numberfield><!--}}}-->

			<numberfield name="damagestrain"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>381</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.windowlist.window.getDatabaseNode().getChild("health.damage").setValue(window.windowlist.window.getDatabaseNode().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Damage roll Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.woundthreshold.total").getValue() then
							window.windowlist.window.getDatabaseNode().getChild("health.wounds").setValue(window.windowlist.window.getDatabaseNode().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Damage roll Strain Wound [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
						if window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						elseif window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 2, 2, 2, 2);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 2, 2, 2, 2);
								window.setFrame(nil);
							end
						end
					end
					function onWheel()
						return true;
					end
				</script>
				<readonly />
			</numberfield><!--}}}-->

			<buttoncontrol name="fullattack">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>398</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_zoom</normal>
					<hover>indicator_casterprep</hover>
					<pressed>indicator_zoom</pressed>
				</icon> 	
				<script>
					function onButtonPress()
						win = Interface.openWindow("attackfull",window.getDatabaseNode());
					end
					function onHover(state)
						if state then
							window.setFrame("rowshade");
						else
							window.setFrame(nil);
						end
					end
				</script>
			</buttoncontrol>

			<windowreferencefield name="attack_notes_shortcut">
				<anchored>
					<right>
						<anchor>left</anchor>
						<offset>445</offset>
					</right>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>button_openwindow</normal>
					<empty>button_emptytarget</empty>
					<pressed>button_emptytarget</pressed>
				</icon>
				<allowdrop />
			</windowreferencefield>

				
		</sheetdata>
	</windowclass><!--}}}-->

<!-- DEFENSES LIST ITEM -->	<!--{{{-->
	<windowclass name="defense_listitem">
		<sizelimits>
			<minimum>
				<height>20</height>
			</minimum>
		</sizelimits>
		<sheetdata>
			<checkbox name="activebox">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>5</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onHover(state)
						if state then
							window.setFrame("rowshade");
						else
							window.setFrame(nil);
						end
					end
				</script>
			</checkbox>
			
			<textlistitemvalue name="name">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>33</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>150</width>
					</size>
				</anchored>
				<tabtarget>
					<next>physicaldefensenum</next>
					<prev>initmodnum</prev>
				</tabtarget>
				<font>sheettextsmall</font>
				<script>
					function onDoubleClick()
						win = Interface.openWindow("defensefull",window.getDatabaseNode());
					end
					function onLoseFocus()
						super.onLoseFocus();
						window.windowlist.applySort();
					end
				</script>
			</textlistitemvalue>
			
			<modifiernumber name="physicaldefensenum" source="physicaldefensenum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>188</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>physicaldefensenum.base</name>
					<op>+</op>
				</source>
				<modifierfield>physicaldefensenum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
			<modifiernumber name="spelldefensenum" source="spelldefensenum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>214</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>spelldefensenum.base</name>
					<op>+</op>
				</source>
				<modifierfield>spelldefensenum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
			<modifiernumber name="socialdefensenum" source="socialdefensenum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>240</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>socialdefensenum.base</name>
					<op>+</op>
				</source>
				<modifierfield>socialdefensenum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->

			<modifiernumber name="physicalarmornum" source="physicalarmornum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>270</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>physicalarmornum.base</name>
					<op>+</op>
				</source>
				<modifierfield>physicalarmornum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->
			<modifiernumber name="mysticarmornum" source="mysticarmornum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>297</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>mysticarmornum.base</name>
					<op>+</op>
				</source>
				<modifierfield>mysticarmornum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->

			<modifiernumber name="initmodnum" source="initmodnum.total"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>332</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>textline</name>
					<offset>1,0,0,0</offset>
				</frame>
				<font>sheettextsmall</font>
				<readonly />
				<source>
					<name>initmodnum.base</name>
					<op>+</op>
				</source>
				<modifierfield>initmodnum.total.temp</modifierfield>
				<modifierloc>right</modifierloc>
				<script>
					function onHover(state)
						if state then
							setColor("#FF228822");
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								window.setFrame(nil);
							end
						end
					end
				</script>
			</modifiernumber><!--}}}-->

			<checkbox name="strainonattack"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>366</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onInit()
						super.onInit();
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
							window.strainonattack.setVisible(false);
						else
							window.attackstrain.setVisible(false);
							window.strainonattack.setVisible(true);
						end
					end
					function onClickDown(button, x, y)
						return false;
					end
					function onValueChanged()
						if window.strainonattack.getState() == true then
							window.attackstrain.setVisible(true);
							window.strainonattack.setVisible(false);
						else
							window.attackstrain.setVisible(false);
							window.strainonattack.setVisible(true);
						end
					end
				</script>
			</checkbox><!--}}}-->
			
			<checkbox name="strainondamage"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>384</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
					<size>
						<width>15</width>
						<height>15</height>
					</size>
				</anchored>
				<script>
					function onInit()
						super.onInit();
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
							window.strainondamage.setVisible(false);
						else
							window.damagestrain.setVisible(false);
							window.strainondamage.setVisible(true);
						end
					end
					function onClickDown(button, x, y)
						return false;
					end
					function onValueChanged()
						if window.strainondamage.getState() == true then
							window.damagestrain.setVisible(true);
							window.strainondamage.setVisible(false);
						else
							window.damagestrain.setVisible(false);
							window.strainondamage.setVisible(true);
						end
					end
				</script>
			</checkbox><!--}}}-->

			<numberfield name="attackstrain"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>363</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.windowlist.window.getDatabaseNode().getChild("health.damage").setValue(window.windowlist.window.getDatabaseNode().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.woundthreshold.total").getValue() then
							window.windowlist.window.getDatabaseNode().getChild("health.wounds").setValue(window.windowlist.window.getDatabaseNode().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Wound [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
						if window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						elseif window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 2, 2, 2, 2);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 2, 2, 2, 2);
								window.setFrame(nil);
							end
						end
					end
					function onWheel()
						return true;
					end
				</script>
				<readonly />
			</numberfield><!--}}}-->

			<numberfield name="damagestrain"><!--{{{-->
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>381</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>-1</offset>
					</top>
					<size>
						<width>20</width>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<font>sheetnumber</font>
				<script>
					function onDoubleClick()
						if User.isHost() then
							userguy = GmIdentityManager.getCurrent();
						else
							userguy = User.getIdentityLabel();
						end
						window.windowlist.window.getDatabaseNode().getChild("health.damage").setValue(window.windowlist.window.getDatabaseNode().getChild("health.damage").getValue() + getValue());
						ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Damage [" .. window.name.getValue() .. " ( " .. getValue() ..")] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});

						if getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.woundthreshold.total").getValue() then
							window.windowlist.window.getDatabaseNode().getChild("health.wounds").setValue(window.windowlist.window.getDatabaseNode().getChild("health.wounds").getValue() + 1);
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Strain Wound [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
						if window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.death.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Death [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						elseif window.windowlist.window.getDatabaseNode().getChild("totdamage").getValue() &gt;= window.windowlist.window.getDatabaseNode().getChild("health.unconscious.total").getValue() then
							ChatManager.control.deliverMessage({ font = "narratorfont", text = "[" .. userguy .. "]" .. ": Unconscious [" .. window.name.getValue() .. "] --> " .. window.windowlist.window.getDatabaseNode().getChild("name").getValue(), mode = "emote"});
						end
							
					end
					function onHover(state)
						if state then
							setColor("#FF882222");
							setFrame("sheetfocus", 2, 2, 2, 2);
							window.setFrame("rowshade");
						else
							if hasFocus() == false then
								setColor(nil);
								setFrame("modifier", 2, 2, 2, 2);
								window.setFrame(nil);
							end
						end
					end
					function onWheel()
						return true;
					end
				</script>
				<readonly />
			</numberfield><!--}}}-->
	
			<buttoncontrol name="fulldefense">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>398</offset>
					</left>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_zoom</normal>
					<hover>indicator_casterprep</hover>
					<pressed>indicator_zoom</pressed>
				</icon> 	
				<script>
					function onButtonPress()
						win = Interface.openWindow("defensefull",window.getDatabaseNode());
					end
					function onHover(state)
						if state then
							window.setFrame("rowshade");
						else
							window.setFrame(nil);
						end
					end
				</script>
			</buttoncontrol>

			<windowreferencefield name="defense_notes_shortcut">
				<anchored>
					<right>
						<anchor>left</anchor>
						<offset>445</offset>
					</right>
					<top>
						<anchor>top</anchor>
						<offset>0</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>button_openwindow</normal>
					<empty>button_emptytarget</empty>
					<pressed>button_emptytarget</pressed>
				</icon>
				<allowdrop />
				<script>
					function onHover(state)
						if state then
							window.setFrame("rowshade");
						else
							window.setFrame(nil);
						end
					end
				</script>
			</windowreferencefield>

				
		</sheetdata>
	</windowclass><!--}}}-->

	


</root>
